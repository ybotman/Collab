# Session Handoff: Fulton @ 2026-02-17T22:27

## Current Status
PROD DOWN - Root cause: Something in our codebase breaks trigger sync (NOT Azure infrastructure)

## Active Ticket
- **Ticket**: None (operational emergency)
- **Status**: in_progress

## CRITICAL DISCOVERY

**Azure Functions infrastructure is WORKING.** Minimal "hello world" function deploys and runs fine.

The problem is **our codebase** causes trigger sync to fail with BadRequest.

## What We Proved
1. Created minimal function with `func init` + `func new`
2. Deployed to CalendarAF-Test2
3. Trigger sync SUCCEEDED
4. Function works: `curl .../api/hello` → "Hello, world!"

## Prime Suspects
1. **Firebase Admin SDK** - Added in recent commits to Admin_DataHealth.js
2. **Large package size** - 182MB vs 215KB minimal
3. **One of 30+ functions** has startup error blocking sync

## Recent Code Changes
- `src/functions/Admin_DataHealth.js` - Added Firebase Admin SDK  
- `src/functions/Admin_UserActivity.js` - Changed Users → userlogins

## Error Pattern
- Upload: ✅ Success
- Deployment: ✅ Success  
- Trigger sync: ❌ Retries 6x then BadRequest

## Apps Status
| App | Status |
|-----|--------|
| CalendarBEAF-TEST | ✅ WORKS (Feb 12, don't touch!) |
| CalendarBEAF-PROD | ❌ 503 |
| CalendarAF-Test2 (minimal) | ✅ WORKS |
| CalendarAF-Test2 (full code) | ❌ FAILS |

## Next Session Should
1. **Deploy older version** - Before Firebase changes (pre-1bbc4f0b)
2. **Or binary search** - Deploy half functions to isolate failing one
3. **Check FIREBASE_SERVICE_ACCOUNT_JSON** - May not be set on PROD

## Git State
- On PROD branch  
- Documentation committed: `docs/PROD-OUTAGE-2026-02-17.md`

## DO NOT
- **DO NOT redeploy CalendarBEAF-TEST** - Only working production app!
