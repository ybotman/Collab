# Session Handoff: Fulton @ 2026-02-17T00:43

## Current Status
Data quality audit complete; PROD→TEST sync script ready to run.

## Active Ticket
- **Ticket**: None (data quality / ops work)
- **Status**: ready for execution

## What I Did This Session
- Synced all git branches (DEVL → TEST → PROD) to commit `b2228822` (v1.21.0)
- Fixed 4 Cape Cod events missing masteredCityId (assigned to Boston)
- Fixed 2 venues missing masteredCityId (Mango Studio Rental, Cherry Hill Cohousing → Boston)
- Investigated event display discrepancy between TangoTiempo and BostonTangoCalendar
- **Found FE bug**: UserLocationLoader overwrites /boston hardcoded location with user's mapCenter
- Audited PROD data quality:
  - 359 future manual events missing lat/long (need denormalization)
  - 100% of manual events lack event-level lat/long
  - 167 discovered events use unapproved venues
- Prepared `syncProdToTest.js` script for calendar-be-af:
  - Fixed to work standalone (no external logger dependency)
  - Added MONGODB_URI_PROD and MONGODB_URI_TEST to local.settings.json
  - Dry run successful: 2,620 docs ready to sync (2025-2026 events)
- Updated CLAUDE.md with:
  - MongoDB database naming (TangoTiempo=TEST, TangoTiempoProd=PROD)
  - Sync script documentation

## Next Session Should
1. Check inbox for messages
2. **Run sync script** if user approves: `node scripts/syncProdToTest.js --include-events --events-from 2025-01-01 --events-to 2026-12-31`
3. Consider running lat/long denormalization for 359 manual events missing geo data
4. FE fix for UserLocationLoader bug was identified - verify it's deployed

## Key Decisions Made
- Use Boston masteredCityId for Cape Cod events (no Cape Cod mastered city exists)
- Script loads env from local.settings.json (Azure Functions pattern) instead of .env

## Context for Future Me
- **FE Bug Found**: tangotiempo.com/boston makes 3 API calls - the 3rd uses user's saved mapCenter instead of Boston hardcoded coords. Fix is in UserLocationLoader.js to not overwrite on /boston route.
- PROD has 1670 events total, 1016 manual, 654 discovered
- All manual events have masteredCityId but NO lat/long - geo queries miss them
- Category 2 masteredCityId mismatches (7 events) are HarmonyJunction appId=2 vs appId=1 duplicates - leave as-is
