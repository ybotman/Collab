# Session Handoff: Fulton @ 2026-02-17T21:15

## Current Status
PROD IS DOWN - Trigger sync failing on ALL new deployments. TEST still works.

## Active Ticket
- **Ticket**: None (operational emergency)
- **Status**: blocked

## What Happened This Session
1. Changed CalendarBEAF-PROD MONGODB_URI to TangoTiempoProd
2. PROD started returning 503 - "Sync Web Apps Function Triggers" failing with BadRequest
3. Reverted MONGODB_URI back to TangoTiempo - still 503
4. Reverted code changes - still 503
5. Created new function app CalendarAF-PROD - same 503 issue
6. Deployed older code (Feb 11 commit b2228822) - STILL 503
7. **Conclusion: Problem is NOT the code - same code works on TEST**

## Key Finding
- CalendarBEAF-TEST works (deployed Feb 12)
- ANY new deployment fails with trigger sync BadRequest
- Even deploying exact same code from when TEST worked = FAILS

## Backup Files Created
- `prod-settings-backup.json` - CalendarBEAF-PROD env vars (24 settings)
- `test-settings-backup.json` - CalendarBEAF-TEST env vars (23 settings)

## Current State
| App | URL | Status |
|-----|-----|--------|
| CalendarBEAF-PROD | calendarbeaf-prod.azurewebsites.net | DOWN (503) |
| CalendarBEAF-TEST | calendarbeaf-test.azurewebsites.net | WORKING |
| CalendarAF-PROD | calendaraf-prod.azurewebsites.net | DOWN (503) |

## Possible Causes (Not Code)
1. Azure Functions runtime issue/outage
2. App Service Plan issue
3. Storage account issue
4. Regional Azure problem
5. Something changed in Azure since Feb 12

## Next Session Should
1. Check Azure status page for outages
2. Try deploying to TEST to see if it still works (risky - could break working app)
3. Compare App Service Plans between TEST and PROD
4. Check Azure Portal "Diagnose and solve problems"
5. Consider opening Azure support ticket

## Commands to Test
```bash
curl https://calendarbeaf-test.azurewebsites.net/api/health   # Should work
curl https://calendarbeaf-prod.azurewebsites.net/api/health  # 503
curl https://calendaraf-prod.azurewebsites.net/api/health    # 503
```

## MONGODB URIs (All Same)
All three apps point to TangoTiempo - MongoDB is NOT the issue.

## Context for Future Me
The trigger sync "BadRequest" error happens during Azure Functions endpoint registration, BEFORE any code runs. Same code that works on TEST fails on new deployments. This is an Azure infrastructure issue, not a code issue.
