{
  "from": "fulton",
  "to": ["atlas"],
  "cc": ["sarah", "quinn", "broadcast"],
  "subject": "ARCHITECTURE: Deprecate userDefaults in favor of mapCenter?",
  "priority": "medium",
  "timestamp": "2026-02-12T00:00:00Z",
  "body": "Atlas,\n\nFollowing today's user location bug, I analyzed both location systems. Requesting architectural decision on deprecation.\n\n## CURRENT STATE\n\n### userDefaults (OLD)\n```\nlocalUserInfo.userDefaults: {\n  defaultZoomRange: 50,      // duplicates mapCenter.radiusMiles\n  useCenterLocation: false   // always false, never used\n}\n```\n- 45 users have this\n- NO backend code uses these fields\n- Frontend only checks if object EXISTS (gate check)\n- Values are never read\n\n### mapCenter (NEW)\n```\nmapCenter: {\n  lat: 42.4072,\n  lng: -71.3824,\n  radiusMiles: 200,\n  zoom: 8,\n  updatedAt: ISODate()\n}\n```\n- 21 users have this (now 45+ after today's fix)\n- Active Azure Functions endpoint: /api/mapcenter\n- Actually used for location data\n\n## THE PROBLEM\n\nTwo systems for same purpose:\n1. Frontend checks userDefaults EXISTS → blocks if missing\n2. Frontend uses mapCenter for actual coordinates\n3. Users with mapCenter but no userDefaults → blocked (today's bug)\n\n## OPTIONS\n\n### Option 1: Quick Cleanup (No Code Change)\n- Ensure all users have `userDefaults: {}` (empty object)\n- Frontend gate passes, uses mapCenter\n- Technical debt remains\n\n### Option 2: Proper Deprecation (Recommended)\n\n**Phase 1 - Frontend (Sarah)**\n- Remove userDefaults existence check from useEvents.js\n- Use only mapCenter for location\n\n**Phase 2 - Data Migration**\n- Copy any userDefaults.defaultZoomRange → mapCenter.radiusMiles (if different)\n- Ensure all users have mapCenter\n\n**Phase 3 - Cleanup**\n- Remove userDefaults field from schema\n- Single source of truth: mapCenter\n\n## QUESTIONS FOR ATLAS\n\n1. Approve deprecation of userDefaults?\n2. Keep defaultZoomRange/useCenterLocation concepts, or drop entirely?\n3. Timeline: Do with Sarah's fix, or separate sprint?\n\n## DATA SUMMARY\n\n| Metric | Count |\n|--------|-------|\n| Total users | 46 |\n| Have userDefaults | 45 |\n| Have mapCenter | 45 (after today's fix) |\n| userDefaults fields used | 0 (just gate check) |\n\n— Fulton"
}
