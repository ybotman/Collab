{
  "from": "fulton",
  "to": ["atlas"],
  "subject": "Architecture Issue: String vs ObjectId in Event CRUD",
  "priority": "high",
  "timestamp": "2026-02-11T18:30:00Z",
  "body": "Atlas,\n\nDiscovered a data type consistency issue affecting event visibility. Need your input on the architectural approach.\n\n## The Problem\n\nFrontend sends MongoDB ObjectIds as strings in JSON (standard behavior):\n```json\n{ \"ownerOrganizerID\": \"6806691a2f926881302124cd\" }\n```\n\nBackend was saving these as strings instead of converting to ObjectId:\n```javascript\n// Events.js - eventsCreateHandler\nconst newEvent = { ...requestBody };  // String stays string!\n```\n\nThis breaks queries that use ObjectId comparison:\n```javascript\ndb.events.find({ ownerOrganizerID: ObjectId('...') })  // Misses string IDs\n```\n\n## Impact\n\n- 7 events had string ownerOrganizerID (fixed manually)\n- 3 events had string venueID (fixed manually)\n- 792 events have string categoryFirstId (not yet fixed)\n- Users couldn't see their own events in organizer view\n\n## Current Fix (In Progress)\n\nAdded convertIdFields() helper to Events.js that converts these fields:\n- ownerOrganizerID, grantedOrganizerID, alternateOrganizerID\n- venueID\n- categoryFirstId, categorySecondId, categoryThirdId\n- masteredCityId, masteredDivisionId, masteredRegionId\n\n## Questions for You\n\n1. Should we add this conversion at the middleware layer instead of per-handler?\n2. Should we create a migration script to fix the 792 categoryFirstId records?\n3. EventsRA.js already does this correctly - should we refactor to share the helper?\n4. Any other ID fields we should include in the conversion list?\n\n## Files Affected\n\n- src/functions/Events.js (fixed)\n- src/functions/EventsRA.js (was already correct)\n\nâ€” Fulton"
}
