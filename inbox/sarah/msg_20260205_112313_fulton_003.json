{
  "from": "fulton",
  "to": ["sarah"],
  "subject": "IMPORTANT: Pills vs Circle — Two Separate Data Flows",
  "ticket": "TIEMPO-360",
  "priority": "high",
  "timestamp": "2026-02-05T15:45:00Z",
  "body": "Hey Sarah!\n\nQuick clarification from Gotan on an important UX distinction:\n\n## Two Independent Concepts\n\n| Feature | Purpose | Data Scope |\n|---------|---------|------------|\n| **Density Pills** | Discovery — \"Where are events worldwide?\" | Map viewport bounds |\n| **Circle/Radius** | Selection — \"Center my calendar here\" | User's chosen point + miles |\n\n**Pills are NOT filtered by the user's circle.** They show ALL events visible on the map for exploration.\n\n## Function Design\n\n```javascript\n// ============================================\n// DISCOVERY: Density pills for map exploration\n// ============================================\nasync function fetchDensityPills({ bounds, zoom, timeRangeDays }) {\n  const startDate = new Date();\n  const endDate = new Date();\n  endDate.setDate(endDate.getDate() + timeRangeDays);\n\n  // Uses viewport bounds — NOT user's circle\n  const events = await api.get('/api/events', {\n    params: {\n      appId: 1,\n      // Bounding box from map viewport\n      swLat: bounds.sw.lat,\n      swLng: bounds.sw.lng,\n      neLat: bounds.ne.lat,\n      neLng: bounds.ne.lng,\n      startDate: startDate.toISOString(),\n      endDate: endDate.toISOString(),\n      limit: 1000  // or paginate\n    }\n  });\n\n  // FE aggregates by hierarchy level based on zoom\n  return aggregateByHierarchy(events, zoom);\n}\n\n// ============================================\n// SELECTION: User's calendar center\n// ============================================\nasync function fetchCalendarEvents({ center, radiusMiles, timeRangeDays }) {\n  const startDate = new Date();\n  const endDate = new Date();\n  endDate.setDate(endDate.getDate() + timeRangeDays);\n\n  // Uses user's selected point + radius\n  const events = await api.get('/api/events', {\n    params: {\n      appId: 1,\n      latitude: center.lat,\n      longitude: center.lng,\n      radius: radiusMiles,\n      startDate: startDate.toISOString(),\n      endDate: endDate.toISOString()\n    }\n  });\n\n  return events;  // No aggregation — full event list\n}\n```\n\n## User Flow\n\n1. User opens MapCenterModal\n2. Map shows density pills (viewport-based) — \"Oh, lots of events in Buenos Aires!\"\n3. User clicks a location to set their center\n4. Circle appears showing their radius\n5. User saves → Calendar now shows events within THAT circle\n\n**Pills = Exploration tool**\n**Circle = Commitment tool**\n\n## BE Support\n\nEvents GET already supports both patterns:\n- Bounding box: `swLat`, `swLng`, `neLat`, `neLng`\n- Radius: `latitude`, `longitude`, `radius`\n\nBoth support `startDate` / `endDate` for time filtering.\n\nLet me know if you need any BE changes!\n\n— Fulton"
}
