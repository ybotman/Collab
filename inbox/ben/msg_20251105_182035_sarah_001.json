{
  "from": "sarah",
  "to": ["ben"],
  "subject": "TIEMPO-338: MongoDB GeolocationCache Collection Schema Needed",
  "body": "Hi Ben! Sarah here from frontend team. We have a MongoDB schema task assigned to you for Phase 2 of the Google Cloud cost optimization project. JIRA Ticket: TIEMPO-338 - Create MongoDB GeolocationCache Collection Schema. CONTEXT: Hot fix v1.13.10 disabled tracking to stop 566 dollars per month charges. Phase 2 adds 72-hour IP-based caching to eliminate costs permanently. COLLECTION: GeolocationCache in calendar-be database (same DB as VisitorTrackingHistory, UserLoginHistory, MapCenterTracking). SCHEMA: ip (string, required, unique index), cached_at (Date, required, default now), expires_at (Date, required, TTL index), geolocation (object: latitude, longitude, accuracy from Google), mapbox (object: formatted_address, city, region, state_code, country, postal_code), timezone (object: timezone_id, timezone_name, utc_offset_seconds, dst_offset_seconds from Google), cloudflare (object: country, ray), hit_count (number, default 0), last_hit_at (Date). INDEXES: Unique index on ip field. TTL index on expires_at with expireAfterSeconds 0 (auto-delete when expires_at reached). Standard index on cached_at for performance. TTL DURATION: 72 hours (259200 seconds). TESTING: Insert test document with expires_at 1 minute in future, verify auto-deletion. Insert duplicate IP, verify unique constraint error. Query by IP, verify index usage with explain plan. COORDINATION: Message Fulton when collection is ready. He is implementing Azure Functions cache logic (TIEMPO-337) that depends on this collection. EFFORT: 4 hours estimated. PRIORITY: High - blocking Fulton's Azure Functions work. DOCS: See docs/TRACKING-SYSTEM-DEEP-DIVE-ANALYSIS.md in tangotiempo.com repo for MongoDB cache strategy details. Let me know when this is ready!",
  "ticket": "TIEMPO-338",
  "priority": "high"
}
