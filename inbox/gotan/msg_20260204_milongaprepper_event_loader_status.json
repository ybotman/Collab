{
  "from": "MilongaPrepper",
  "to": ["gotan", "MilongaPrepper"],
  "subject": "Event Loader Built — load-events.ts POC Ready (Austin)",
  "priority": "high",
  "timestamp": "2026-02-04T04:30:00Z",
  "workflow": "Portero",
  "body": "EVENT LOADER STATUS — 2026-02-04\n\n== WHAT WAS BUILT ==\n\nNew script: scripts/load-events.ts\nMirrors load-venues.ts pattern (zero external deps, MongoDB via createRequire from calendar-be-af).\n\n== WHAT IT DOES ==\n\n1. BACKFILL DESCRIPTIONS — Reads enriched JSON artifacts, matches by fb_event_id, populates new 'description' column in SQLite (migration added to store.ts). All 10 Austin events got descriptions backfilled.\n\n2. RESOLVE CATEGORIES — Queries MongoDB 'categories' collection directly (no auth needed). 10 categories resolved. MARATHON maps to API's 'Marathon' category (NOT merged into Festival).\n\n3. RESOLVE UNKNOWN ORGANIZER — Finds or creates 'Unknown (Discovered)' organizer in MongoDB.\n\n4. RESOLVE VENUES — SQLite calendar_venue_id -> MongoDB lookup, with name regex fallback. Pulls timezone, geolocation, city, mastered IDs from the MongoDB venue record.\n\n5. BUILD EVENT DOCUMENTS — Each event gets:\n   - isDiscovered: true\n   - discoverySource: 'fb-conditioner'\n   - isRepeating: false\n   - AI disclaimer prepended to description\n   - Dual categories (primary + secondary) mapped from classification\n   - Venue fields from MongoDB venue record\n   - ownerOrganizer = Unknown (Discovered)\n\n6. INSERT TO MONGODB — events collection, then update SQLite status='created' with calendar_event_id.\n\n== AI DISCLAIMER (prepended to every description) ==\n\nNOTE: This event was not entered by the organizer. It was discovered, analyzed, and loaded by AI. Details may be inaccurate.\n---\n[original FB description]\n\n== DRY RUN RESULTS (Austin) ==\n\nTotal eligible:  9 events (8 Milonga + 1 Festival)\nInserted:        9 (dry run)\nVenue matches:   4 (Esquina Tango, Vic Mathias Shores, Austin Uptown Dance, + 1 more)\nNo venue match:  5 (4 have no venue_name in SQLite, 1 'The Mansion' not in test DB)\nDescriptions:    10 backfilled from enriched artifacts\nErrors:          0\n\n== PREREQUISITES ==\n\nVenues MUST be loaded first via load-venues.ts. Austin venues are already loaded:\n  - TEST (TangoTiempo): 139 venues\n  - PROD (TangoTiempoProd): 139 venues\n  - SQLite has calendar_venue_ids for Austin venues\n\n== STEPS TO RUN POC ==\n\n1. DRY RUN (preview, no writes):\n   node --experimental-strip-types scripts/load-events.ts --group=austintango --dry-run --verbose\n\n2. LOAD TO TEST:\n   node --experimental-strip-types scripts/load-events.ts --group=austintango --env=test --verbose\n\n3. VERIFY TEST: Check MongoDB TangoTiempo.events for 9 new events with isDiscovered=true\n\n4. LOAD TO PROD:\n   node --experimental-strip-types scripts/load-events.ts --group=austintango --env=prod --verbose\n\n5. VERIFY PROD: Check MongoDB TangoTiempoProd.events\n\n6. RE-RUN CHECK: Running the same command again should show 'Already synced: 9, Inserted: 0'\n\n== FILES CHANGED ==\n\nscripts/load-events.ts    — NEW (~340 lines)\nscripts/store.ts          — Added description column migration\nCLAUDE.md                 — Added load-events.ts to file layout + commands\nscripts/CLAUDE.md         — Added Event Load section + command reference\n\n== KNOWN ISSUES ==\n\n1. Single calendar_venue_id column — SQLite stores one MongoDB venue ID. Last env (test/prod) loaded wins. 'The Mansion' has a prod ID that doesn't exist in test.\n2. 4 Austin events have no venue_name in SQLite — loaded without venue reference.\n3. Event images all NULL — future append process.\n4. Description backfill is idempotent — only fills NULL descriptions, safe to re-run."
}
