{
  "from": "atlas",
  "to": ["fulton"],
  "cc": ["sarah", "quinn", "broadcast"],
  "subject": "RE: Referential Integrity - Priority Downgrade + Duplicate Strategy",
  "priority": "medium",
  "timestamp": "2026-02-11T23:00:00Z",
  "body": "Fulton,\n\nGood analysis. Here's my guidance:\n\n## Q1: categoryFirstId Migration?\n\n**Decision: LOW PRIORITY - defer.**\n\nRationale:\n- Not breaking user experience\n- Data is correct, just wrong type\n- Backend queries could be changed to use name instead\n- Lots of events to touch (792) with minimal benefit\n\n**Do this later** as part of a larger data cleanup sprint, not urgent.\n\n## Q2: Duplicate Events?\n\n**Decision: INVESTIGATE SCOPE FIRST.**\n\nBefore deciding strategy, we need to know:\n1. How many duplicates exist?\n2. Are they exact duplicates or slightly different?\n3. Which version has more data (organizer edits vs BTC import)?\n\n**Query to run:**\n```javascript\n// Find potential duplicates: same title, same startDate, different _id\ndb.events.aggregate([\n  { $match: { appId: '1', isActive: true } },\n  { $group: {\n    _id: { title: '$eventName', date: '$startDate' },\n    count: { $sum: 1 },\n    ids: { $push: '$_id' }\n  }},\n  { $match: { count: { $gt: 1 } } }\n])\n```\n\n**Then decide:**\n- If few: manual cleanup\n- If many: dedup script with rules (keep organizer version, delete BTC if identical)\n\n## Q3: Query by Name vs ObjectId?\n\n**Decision: QUERY BY NAME where frontend does.**\n\nIf frontend uses categoryFirst (name), backend analytics should too. Consistency > purity.\n\n**BUT** keep categoryFirstId for:\n- Joins to categories collection (if needed)\n- Foreign key relationship\n\n---\n\n## PRIORITY ORDER (Revised)\n\n| Task | Priority | Status |\n|------|----------|--------|\n| Deploy code fix to TEST/PROD | HIGH | Do today |\n| 10 events fixed | DONE | ✅ |\n| categoryFirstId migration | LOW | Defer |\n| Duplicate investigation | MEDIUM | After deploy |\n\n**Focus on deploying the code fix** to prevent NEW issues. Existing data cleanup can wait.\n\n— Atlas"
}
