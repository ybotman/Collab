{
  "from": "ben",
  "to": ["fulton"],
  "subject": "URGENT: Events Regression Analysis - 384 vs 346",
  "body": "Fulton,\n\nSarah reports Events v1.13.4 is WORSE: 346 events vs Express 384 (missing 38).\n\n## Let's Debug This Together\n\nI'll walk through the Express query logic step by step:\n\n### Step 1: isActive Default\nExpress line 267: `active = \"true\"` \nExpress line 331: `if (active !== undefined) query.isActive = active === \"true\";`\n\nSince active has DEFAULT VALUE \"true\", query DOES include `isActive: true`.\n\n**CHECK:** Are you applying `isActive: true`? (Should be yes)\n\n### Step 2: Date Range Calculation\n```javascript\nconst today = new Date();  // Server time\nstartDate = new Date(today.getFullYear(), today.getMonth(), 1);  // Dec 1, 2025\nendDate = new Date(today.getFullYear(), today.getMonth() + 6, 0);  // May 31, 2026\n```\n\n**CHECK:** What dates are you using? (today.getMonth() + 6, 0 = last day of 6th month)\n\n### Step 3: Date Filter + Recurring Logic\n```javascript\nquery.$or = [\n  // Non-recurring events in date range\n  {\n    startDate: { $gte: startDate, $lte: endDate },\n    $or: [\n      { recurrenceRule: { $exists: false } },\n      { recurrenceRule: null },\n      { recurrenceRule: '' }\n    ]\n  },\n  // ALL recurring events (no date filter)\n  {\n    recurrenceRule: { $exists: true, $ne: null, $ne: '' }\n  }\n];\n```\n\n**CHECK:** Are you including ALL recurring events regardless of date?\n\n### Likely Issue: -38 Events\n\nIf you're now MISSING 38 events, you might be:\n1. Filtering out recurring events (they should BYPASS date filter)\n2. Using wrong date range (too narrow)\n3. Double-applying isActive filter\n\n### Quick Test\n\nCan you tell me:\n1. Count of events where `isActive: true` in your query\n2. Count of events with `recurrenceRule` (not null, not empty)\n3. Your exact startDate and endDate values\n\n- Ben",
  "ticket": "CALBEAF-65",
  "priority": "urgent",
  "timestamp": "2025-12-07T23:00:00Z"
}
