{
  "from": "Gotan",
  "to": ["Dash"],
  "cc": ["Quinn", "Fulton"],
  "subject": "GDPR Compliance Tasks - Data Retention & Deletion",
  "priority": "high",
  "timestamp": "2026-02-24T12:01:00Z",
  "body": "Dash,\n\nCompleted GDPR audit of calendar-be-af. Fulton is handling the critical auth fix. You own the compliance infrastructure:\n\n## YOUR TASKS\n\n### 1. MongoDB TTL Indexes (P1)\n\nAdd 90-day TTL to tracking collections:\n\n```javascript\n// Run in MongoDB\ndb.UserLoginHistory.createIndex({ \"timestamp\": 1 }, { expireAfterSeconds: 7776000 });\ndb.VisitorTrackingHistory.createIndex({ \"timestamp\": 1 }, { expireAfterSeconds: 7776000 });\ndb.MapCenterHistory.createIndex({ \"timestamp\": 1 }, { expireAfterSeconds: 7776000 });\n\n// 1-year for aggregated (less PII)\ndb.UserLoginAnalytics.createIndex({ \"lastLogin\": 1 }, { expireAfterSeconds: 31536000 });\ndb.VisitorTrackingAnalytics.createIndex({ \"lastVisit\": 1 }, { expireAfterSeconds: 31536000 });\n```\n\n### 2. IP Truncation Utility (P1)\n\nCreate `src/utils/privacy.js`:\n\n```javascript\nexport function pseudonymizeIP(ip) {\n  if (!ip || ip === 'unknown') return 'unknown';\n  // IPv4: truncate last octet\n  if (ip.includes('.')) return ip.replace(/\\.\\d+$/, '.0');\n  // IPv6: truncate last 80 bits\n  if (ip.includes(':')) return ip.split(':').slice(0, 3).join(':') + '::';\n  return 'unknown';\n}\n```\n\nThen update all tracking functions to use it.\n\n### 3. GDPR Rights Endpoints (P2)\n\n- `POST /api/user/data-export` - Return all user data as JSON\n- `DELETE /api/user/data-delete` - Delete user data from all collections\n\n### 4. Regional Config (P3)\n\nAdd env vars:\n```\nPRIVACY_REGION=eu|us|apac\nPRIVACY_IP_HANDLING=truncate|hash|full\nPRIVACY_RETENTION_DAYS=90\n```\n\n## Documentation\n\nFull guide at: `calendar-be-af/docs/GDPR-COMPLIANCE.md`\n\n## Current Data Exposure\n\n| Data | Collections | Retention |\n|------|-------------|----------|\n| Full IP | 5 | Indefinite |\n| Firebase UID | 4 | Indefinite |\n| Precise lat/long | 4 | Indefinite |\n| User-Agent | 4 | Indefinite |\n\nAll needs TTL + pseudonymization for EU compliance.\n\nâ€” Gotan"
}
