{
  "from": "fulton",
  "to": ["dash"],
  "subject": "SPEC: Unified User Activity View (query by userId, IP, or visitorId)",
  "priority": "medium",
  "timestamp": "2026-02-24T04:45:00Z",
  "body": "Dash,\n\n**Feature Request from Ybotman**: CalOps needs a unified activity page that shows all connected activity for a user.\n\n## User Story\nAdmin enters ONE of: firebaseUserId, IP address, or visitorId\nCalOps shows ALL related activity across both collections.\n\n## Available Endpoints\n\n### 1. Login History (authenticated users)\n```\nGET /api/analytics/login-history\n  ?firebaseUserId=xxx    # Filter by user\n  ?ip=xxx                # Filter by IP\n  ?range=All             # Time range\n  ?limit=100\n```\n\nReturns: firebaseUserId, ip, timestamp, location, deviceType, userAgent\n\n### 2. Visitor History (anonymous visitors)\n```\nGET /api/analytics/visitor-history\n  ?visitorId=xxx         # Filter by visitor cookie\n  ?ip=xxx                # Filter by IP  \n  ?range=All\n  ?limit=100\n```\n\nReturns: visitorId, ip, page, timestamp, location, deviceType\n\n## Cross-Reference Logic (Frontend)\n\nWhen user searches:\n\n**If searching by firebaseUserId:**\n1. Call login-history?firebaseUserId=xxx\n2. Extract unique IPs from results\n3. Call visitor-history?ip=<each IP> to find anonymous visits from same IPs\n4. Display combined timeline\n\n**If searching by IP:**\n1. Call login-history?ip=xxx (find logged-in sessions)\n2. Call visitor-history?ip=xxx (find anonymous visits)\n3. Combine and display\n\n**If searching by visitorId:**\n1. Call visitor-history?visitorId=xxx\n2. Extract unique IPs\n3. Call login-history?ip=<each IP> to find if visitor ever logged in\n4. Display combined timeline\n\n## UI Suggestion\n\n```\n[Search: _______________] [Type: userId|IP|visitorId v] [Search]\n\n=== Identity Summary ===\nFirebase User: cc0j07Nng... (if found)\nVisitor IDs: 253e2003-..., 847f2... (linked by IP)\nKnown IPs: 71.232.30.16, 98.45.123.7\n\n=== Activity Timeline ===\n| Timestamp | Type | IP | Location | Page/Action |\n|-----------|------|-----|----------|-------------|\n| 2026-02-23 17:39 | Login | 71.232... | Boston | - |\n| 2026-02-23 17:38 | Visit | 71.232... | Boston | /calendar |\n| 2026-02-21 14:22 | Login | 98.45...  | NYC    | - |\n```\n\n## Notes\n- Cross-ref happens in CalOps frontend, not backend\n- IP is the join key between visitor and login data\n- Same user may have multiple visitorIds (cookie cleared)\n- Same IP may have multiple users (shared network)\n\nLet me know if you need additional filters or endpoints.\n\n- Fulton"
}
