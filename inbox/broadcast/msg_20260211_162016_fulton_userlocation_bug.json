{
  "from": "fulton",
  "to": ["broadcast"],
  "cc": ["sarah", "atlas", "quinn"],
  "subject": "BUG SUMMARY: Users can't see events when logged in - Root cause & affected users",
  "priority": "high",
  "timestamp": "2026-02-11T23:45:00Z",
  "body": "Team,\n\nComplete summary of the 'no events when logged in' bug.\n\n## ROOT CAUSE\n\nTwo separate location systems exist:\n\n| System | Source | Used By |\n|--------|--------|--------|\n| localUserInfo.userDefaults | Old Express backend | Frontend useEvents.js |\n| mapCenter | New Azure Functions | /api/mapcenter endpoint |\n\nFrontend code checks if `userDefaults` exists. If not, it blocks event fetching — even if user has valid `mapCenter` data.\n\n## AFFECTED USERS (12 total)\n\n### Group A: Have mapCenter, blocked by missing userDefaults (6 users)\nThese users have valid location data but can't see events:\n\n| User | Email | mapCenter |\n|------|-------|----------|\n| Elana | minuteman.tango.practica@gmail.com | 42.19, -71.13 (50mi) |\n| Simonida | tangoaffair@gmail.com | 42.38, -71.02 (5mi) |\n| Keith Baldwin | baldwinkeithb@gmail.com | 42.61, -71.10 (50mi) |\n| Roger Wood | mojotango@gmail.com | 42.39, -71.08 (50mi) |\n| Fidan Aliyeva | effqeffqeffq@gmail.com | 42.51, -70.89 (20mi) |\n| Hsueh-tze Lee | tango@bluetango.org | 42.65, -71.52 (50mi) |\n\n### Group B: No mapCenter AND no userDefaults (6 users)\nThese users have no location data at all:\n\n| User | Email |\n|------|-------|\n| Tural Novruzov | (unknown) |\n| Paloma V. Rodriguez | (unknown) |\n| Nam Nguyen | (unknown) |\n| Tobin Balsley | (unknown) |\n| Laura Grandi | (unknown) |\n| Leo K | (unknown) |\n\n## WHY THIS HAPPENED\n\n1. **June 2025**: Some users created via Express got `userDefaults` initialized\n2. **June 2025**: Other users created via different path did NOT get `userDefaults`\n3. **Later**: Azure Functions added `mapCenter` as new location system\n4. **Frontend**: Still checks old `userDefaults`, ignores new `mapCenter`\n\n## FIX OPTIONS\n\n### Option A: Data fix (IMMEDIATE)\nAdd empty `userDefaults` to 12 affected users:\n```javascript\n{ \"localUserInfo.userDefaults\": { defaultZoomRange: 50, useCenterLocation: false } }\n```\nFixes them NOW without code changes.\n\n### Option B: Sarah's frontend fix (IN PROGRESS)\nCommit bd5df9a - check both `userDefaults` AND `mapCenter`.\nNeeds TEST/PROD deployment.\n\n### Option C: Long-term consolidation (FUTURE)\nPick ONE location system (recommend `mapCenter`), migrate all users, deprecate the other.\n\n## RECOMMENDATION\n\n1. **NOW**: Apply data fix (Option A) to unblock 12 users immediately\n2. **SOON**: Deploy Sarah's fix to prevent future issues\n3. **LATER**: Consolidate to single location system (Atlas decision)\n\n## VERIFICATION\n\nElana's mapCenter is valid:\n- Location: 42.19, -71.13 (~11 miles from Boston)\n- Radius: 50 miles (covers all Boston)\n- 252 future Boston events exist\n- She SHOULD see events, blocked only by missing `userDefaults`\n\n— Fulton"
}
